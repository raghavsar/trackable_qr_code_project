qr.phonon.io {
    # Use a self-signed certificate for now
    tls internal

    # Enable HTTP compression
    encode gzip zstd

    # Trust proxies (e.g., AWS Load Balancer)
    # Replace the example ranges below with your actual AWS LB subnet CIDR(s)
    trusted_proxies 10.20.0.0/19

    # Handle ACME challenge requests for Let's Encrypt SSL
    handle /.well-known/acme-challenge/* {
        respond 200
    }

    # Handle requests starting with /api/
    # Proxy them to the api-gateway service on port 8000
    handle_path /api/* {
        reverse_proxy api-gateway:8000
    }

    # TODO: Add a 'handle' block here if you also want Caddy
    # to serve your frontend application from the same domain.
    # Example:
    # handle {
    #     root * /path/to/your/frontend/build
    #     file_server
    #     try_files {path} /index.html
    # }

    # Logging (optional, Caddy logs by default)
    log {
        output stderr
        format json
    }
} 