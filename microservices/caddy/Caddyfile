{
	# Global options
	debug

	log {
		output file /data/access.log {
			roll_size 10MB
			roll_keep 10
			roll_keep_for 168h
		}
		format json
		level INFO
	}
}

qr.phonon.io {
	# Use the provided certificate and key
	tls /etc/caddy/certs/qr.phonon.io.crt /etc/caddy/certs/qr.phonon.io.key

	# Enable HTTP compression
	encode gzip zstd

	# Handle ACME challenge requests for Let's Encrypt SSL
	handle /.well-known/acme-challenge/* {
		respond "OK" 200
	}

	# Handle requests starting with /api/
	handle_path /api/* {
		# Specify HTTPS scheme in the upstream address
		reverse_proxy https://api-gateway:8000 {
			trusted_proxies private_ranges

			header_up Host {host}
			header_up X-Real-IP {remote_host}

			# Configure TLS settings for the HTTPS upstream connection
			transport http { 
				tls_insecure_skip_verify
			}
		}
	}

	# Logging for this specific site
	log {
		output file /data/qr.phonon.io.log {
			roll_size 10MB
			roll_keep 10
			roll_keep_for 168h
		}
		format json
		level DEBUG
	}
}
