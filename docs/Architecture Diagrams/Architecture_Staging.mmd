graph TD
    subgraph User Facing
        User[User Browser]
    end

    subgraph Internet/Edge
        DNS[DNS Resolution]
        ELB[AWS ELB qr.phonon.io]
    end

    subgraph Internal Network / Proxy
        Caddy[Caddy Reverse Proxy]
    end

    subgraph Application Services
        Frontend[Frontend Service - React App @ :5173]
        APIGateway[API Gateway :8000]
        UserService[User Service :8001]
        VCardService[VCard Service :8002]
        QRService[QR Service :8003]
        AnalyticsService[Analytics Service :8004]
        RedirectService[Redirect Service :8005]
    end

    subgraph Data Stores
        MongoDB[(MongoDB)]
        Redis[(Redis)]
        Minio[(Minio Object Storage)]
    end

    %% Request Flow
    User -- "HTTPS Request" --> DNS
    DNS -- "Resolves to" --> ELB
    User -- "HTTPS Request" --> ELB

    ELB -- "Forwarded Traffic" --> Caddy

    %% Caddy Routing
    Caddy -- "Serves '/'" --> Frontend
    Caddy -- "Proxies '/api/*'" --> APIGateway

    %% Frontend Interaction
    Frontend -- "Serves App" --> User
    User -- "API Calls '/api/*'" --> ELB

    %% API Gateway Routing
    APIGateway -- "Route based on path" --> UserService
    APIGateway -- "Route based on path" --> VCardService
    APIGateway -- "Route based on path" --> QRService
    APIGateway -- "Route based on path" --> AnalyticsService
    APIGateway -- "Route based on path" --> RedirectService

    %% Microservice Dependencies
    UserService -- CRUD --> MongoDB
    VCardService -- CRUD --> MongoDB
    VCardService -- "Stores/Retrieves Files" --> Minio
    QRService -- CRUD --> MongoDB
    AnalyticsService -- "Stores Aggregated Data" --> MongoDB
    AnalyticsService -- "Real-time/Cache" --> Redis
    RedirectService -- "Reads Data" --> MongoDB

    %% Styling (Optional)
    style ELB fill:#f9f,stroke:#333,stroke-width:2px
    style Caddy fill:#ccf,stroke:#333,stroke-width:2px
    style APIGateway fill:#ccf,stroke:#333,stroke-width:2px
    style Frontend fill:#9cf,stroke:#333,stroke-width:2px
    style MongoDB fill:#9c9,stroke:#333,stroke-width:2px
    style Redis fill:#f99,stroke:#333,stroke-width:2px
    style Minio fill:#fc9,stroke:#333,stroke-width:2px
